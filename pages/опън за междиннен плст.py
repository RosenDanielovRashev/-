import streamlit as st
import pandas as pd
import plotly.graph_objects as go
import numpy as np

st.title("–û–ø—Ä–µ–¥–µ–ª—è–Ω–µ –æ–ø—ä–Ω–Ω–æ—Ç–æ –Ω–∞–ø—Ä–µ–∂–µ–Ω–∏–µ –≤ –º–µ–∂–¥–∏–µ–Ω –ø–ª–∞—Å—Ç –æ—Ç –ø—ä—Ç–Ω–∞—Ç–∞—Ç–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Ñ–∏–≥.9.3")

def to_subscript(number):
    subscripts = str.maketrans("0123456789", "‚ÇÄ‚ÇÅ‚ÇÇ‚ÇÉ‚ÇÑ‚ÇÖ‚ÇÜ‚Çá‚Çà‚Çâ")
    return str(number).translate(subscripts)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –Ω–∞–ª–∏—á–∏–µ—Ç–æ –Ω–∞ –¥–∞–Ω–Ω–∏ –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
if "layers_data" not in st.session_state or len(st.session_state.layers_data) == 0:
    st.warning("–ú–æ–ª—è, –ø—ä—Ä–≤–æ –≤—ä–≤–µ–¥–µ—Ç–µ –¥–∞–Ω–Ω–∏—Ç–µ –≤ –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–û—Ä–∞–∑–º–µ—Ä—è–≤–∞–Ω–µ –Ω–∞ –ø—ä—Ç–Ω–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)")
    st.page_link("app.py", label="–ö—ä–º –æ—Å–Ω–æ–≤–Ω–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞", icon="üè†")
    st.stop()

# –í–∑–∏–º–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
layers_data = st.session_state.layers_data
D = st.session_state.get("final_D", 32.04)  # –í–∑–∏–º–∞–º–µ D –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞

# –ü–æ–¥–≥–æ—Ç–≤—è–º–µ –¥–∞–Ω–Ω–∏—Ç–µ –∑–∞ –ø–ª–∞—Å—Ç–æ–≤–µ—Ç–µ
h_values = []
E_values = []
Ed_values = []

for i, layer in enumerate(layers_data):
    h_values.append(layer.get('h', 0))
    E_values.append(layer.get('Ei', 0))
    Ed_values.append(layer.get('Ed', 0))

n = len(layers_data)  # –ë—Ä–æ–π –ø–ª–∞—Å—Ç–æ–≤–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞

# –ü–æ–∫–∞–∑–≤–∞–º–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –ø–ª–∞—Å—Ç–æ–≤–µ—Ç–µ
st.markdown("### –î–∞–Ω–Ω–∏ –∑–∞ –ø–ª–∞—Å—Ç–æ–≤–µ—Ç–µ (–≤–∑–µ—Ç–∏ –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞)")

cols = st.columns(3)
for i in range(n):
    with cols[0]:
        st.metric(f"h{to_subscript(i+1)} (cm)", f"{h_values[i]:.2f}" if h_values[i] else "-")
    with cols[1]:
        st.metric(f"E{to_subscript(i+1)} (MPa)", f"{E_values[i]:.0f}" if E_values[i] else "-")
    with cols[2]:
        st.metric(f"Ed{to_subscript(i+1)} (MPa)", f"{Ed_values[i]:.0f}" if Ed_values[i] else "-")

st.markdown(f"**D = {D} cm** (–≤–∑–µ—Ç–æ –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞)")

# Layer selection (—Å–∞–º–æ –∑–∞ –º–µ–∂–¥–∏–Ω–Ω–∏—Ç–µ –ø–ª–∞—Å—Ç–æ–≤–µ)
if n < 2:
    st.error("–¢—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞—Ç–µ –ø–æ–Ω–µ 2 –ø–ª–∞—Å—Ç–∞ –∑–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ –Ω–∞ –º–µ–∂–¥–∏–Ω–µ–Ω –ø–ª–∞—Å—Ç")
    st.stop()

st.markdown("### –ò–∑–±–µ—Ä–∏ –º–µ–∂–¥–∏–Ω–µ–Ω –ø–ª–∞—Å—Ç –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞")
selected_layer = st.selectbox(
    "–ü–ª–∞—Å—Ç –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞", 
    options=[f"–ü–ª–∞—Å—Ç {i+1}" for i in range(1, n)],  # –ó–∞–ø–æ—á–≤–∞–º–µ –æ—Ç 2-—Ä–∏—è –ø–ª–∞—Å—Ç
    index=0
)
layer_idx = int(selected_layer.split()[-1]) - 1

# –û—Å—Ç–∞–Ω–∞–ª–∞—Ç–∞ —á–∞—Å—Ç –æ—Ç –∫–æ–¥–∞ –æ—Å—Ç–∞–≤–∞ —Å—ä—â–∞—Ç–∞, –Ω–æ –ø—Ä–µ–º–∞—Ö–≤–∞–º–µ —Ä—ä—á–Ω–∏—Ç–µ inputs
# –∏ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –≤–µ—á–µ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–Ω–∏—Ç–µ h_values, E_values, Ed_values

# [–û—Å—Ç–∞–Ω–∞–ª–∞—Ç–∞ —á–∞—Å—Ç –æ—Ç –≤–∞—à–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª–µ–Ω –∫–æ–¥ –∑–∞ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è]
# [–¢—Ä—è–±–≤–∞ –¥–∞ –∑–∞–ø–∞–∑–∏—Ç–µ –≤—Å–∏—á–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –≥—Ä–∞—Ñ–∏–∫–∏, –Ω–æ —Ç–µ –≤–µ—á–µ —â–µ —Ä–∞–±–æ—Ç—è—Ç —Å –¥–∞–Ω–Ω–∏—Ç–µ –æ—Ç –ø—ä—Ä–≤–∞—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞]
